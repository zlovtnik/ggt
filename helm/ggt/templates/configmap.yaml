apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "ggt.fullname" . }}-config
  labels:
    {{- include "ggt.labels" . | nindent 4 }}
data:
  config.yaml: |
    # Kafka configuration
    kafka:
      brokers: {{ .Values.config.kafka.brokers | toJson }}
      consumer_group: "{{ .Values.config.kafka.consumerGroup }}"
      session_timeout: 30000
      heartbeat_interval: 3000
      auto_offset_reset: "earliest"

    # Pipeline configuration
    pipelines:
{{ .Values.config.pipelines | toYaml | indent 6 }}

    # Metrics configuration
    metrics:
      port: {{ .Values.config.metrics.port }}
      buckets:
        transform_duration: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1.0, 2.0, 5.0]

    # Health configuration
    health:
      port: {{ .Values.config.health.port }}

    # Logging configuration
    logging:
      level: "{{ .Values.config.logging.level }}"
      format: "json"